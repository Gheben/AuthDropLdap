# AuthDrop Configuration - Template
# Copy this file to .env and customize the values

# ============================================
# SUPER ADMIN CREDENTIALS
# ============================================
# These credentials will be used to create the super admin user
# on first installation (when database is empty)
# CHANGE THESE VALUES BEFORE FIRST RUN!
SUPER_ADMIN_USERNAME=admin
SUPER_ADMIN_PASSWORD=ChangeThisPassword123!

# ============================================
# SERVER CONFIGURATION
# ============================================
PORT=3441
NODE_ENV=production
DEBUG_MODE=false

# ============================================
# DATABASE CONFIGURATION
# ============================================
# Database type: 'postgres' (recommended) or 'sqlite' (local only)
# NOTE: Docker deployments ALWAYS use PostgreSQL regardless of this setting
# This variable is only used for manual/local installations (npm start)
DB_TYPE=sqlite

# PostgreSQL connection settings (only used if DB_TYPE=postgres)
# For manual installations with PostgreSQL
DB_HOST=localhost
DB_PORT=5432
DB_NAME=authdrop
DB_USER=authdrop
DB_PASSWORD=YourSecurePasswordHere

# ============================================
# DOCKER COMPOSE SPECIFIC
# ============================================
# These variables are used ONLY by docker-compose.yml
# Docker ALWAYS uses PostgreSQL (DB_TYPE is hardcoded to 'postgres' in docker-compose.yml)
# 
# IMPORTANT: These must match the DB_* variables above for consistency!
# The PostgreSQL container uses POSTGRES_* to create the database,
# while the app container uses DB_* to connect to it.
#
# For Docker deployment, set these to secure values:
POSTGRES_DB=authdrop
POSTGRES_USER=authdrop
POSTGRES_PASSWORD=YourSecurePasswordHere

# ============================================
# LDAP/ACTIVE DIRECTORY INTEGRATION
# ============================================
# Enable/disable LDAP integration
LDAP_ENABLED=false

# LDAP/LDAPS Connection
# Use ldap:// for standard LDAP (port 389) or ldaps:// for secure LDAP (port 636)
LDAP_URL=ldaps://dc.yourcompany.local:636
# Alternative for non-secure: ldap://dc.yourcompany.local:389

# TLS Certificate Validation
# Set to false to accept self-signed certificates (for testing only)
LDAP_TLS_REJECT_UNAUTHORIZED=false

# Service Account for LDAP queries
# This account needs read permissions on users and groups
LDAP_BIND_DN=CN=ServiceAccount,OU=ServiceAccounts,DC=yourcompany,DC=local
LDAP_BIND_PASSWORD=YourLDAPServicePassword

# LDAP Base DN (root of LDAP tree)
LDAP_BASE_DN=DC=yourcompany,DC=local

# User Search Configuration
# OPZIONALE: Lascia vuoto o usa filtri molto restrittivi se vuoi importare
# SOLO gli utenti membri dei gruppi specificati sotto.
# Se specifichi gruppi specifici in GROUP_SEARCH_FILTER, verranno importati
# automaticamente SOLO gli utenti membri di quei gruppi.
LDAP_USER_SEARCH_BASE=
LDAP_USER_SEARCH_FILTER=(&(objectClass=user)(!(userAccountControl:1.2.840.113556.1.4.803:=2)))
LDAP_USER_ID_ATTRIBUTE=sAMAccountName
LDAP_USER_EMAIL_ATTRIBUTE=mail
LDAP_USER_DISPLAYNAME_ATTRIBUTE=displayName

# Group Search Configuration
# STRUTTURA CONSIGLIATA SU AD:
# - Crea un gruppo principale (es: "AuthDrop Access")
# - Crea sottogruppi membri del gruppo principale (es: "IT Department", "Sales", "HR")
# - Aggiungi utenti ai sottogruppi (NON al gruppo principale)
#
# RISULTATO:
# - Solo utenti dei sottogruppi potranno accedere
# - Utenti di un sottogruppo vedranno solo i dispositivi del loro gruppo
# - La gerarchia viene mantenuta automaticamente
#
# ESEMPIO DI FILTRO per gruppo principale "AuthDrop Access":
# LDAP_GROUP_SEARCH_FILTER=(|(cn=AuthDrop Access)(memberOf=CN=AuthDrop Access,OU=Groups,DC=yourcompany,DC=local))
#
# Questo importa il gruppo principale + tutti i suoi sottogruppi + relativi utenti
#
LDAP_GROUP_SEARCH_BASE=OU=Groups,DC=yourcompany,DC=local
LDAP_GROUP_SEARCH_FILTER=(|(CN=AuthDrop_Access)(memberOf=CN=AuthDrop_Access,OU=Groups,DC=yourcompany,DC=local))
# IMPORTANTE: Sostituisci "AuthDrop_Access" con il nome del tuo gruppo principale
# e aggiorna il DN completo nel filtro memberOf
LDAP_GROUP_NAME_ATTRIBUTE=cn
LDAP_GROUP_MEMBER_ATTRIBUTE=member

# ============================================
# LDAP AUTO-SYNC CONFIGURATION
# ============================================
# Enable automatic synchronization from Active Directory
# If enabled, LDAP sync will run automatically at the specified interval
# Works with both SQLite (manual installation) and PostgreSQL (Docker)
LDAP_AUTO_SYNC=false

# Sync interval in seconds (default: 3600 = 1 hour)
# Examples:
# - 3600 = 1 hour
# - 7200 = 2 hours
# - 86400 = 24 hours (1 day)
# NOTE: Initial sync runs 30 seconds after server start
LDAP_SYNC_INTERVAL=3600
